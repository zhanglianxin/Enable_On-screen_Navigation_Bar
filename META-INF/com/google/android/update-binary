#!/sbin/sh
OUTFD=/proc/self/fd/$2;
ui_print() {
  while [ "$1" ]; do
    echo -e "ui_print $1\nui_print" >> $OUTFD;
    shift;
  done;
}

ui_print " "
ui_print "Only Enable Wireless Debugging"

# Modern devices use /system as root ("/")
system_as_root=`getprop ro.build.system_root_image`
if [ "$system_as_root" == "true" ]; then
    umount /system_root
    partition=/system_root
    prop=/system_root/system/build.prop
    cacerts=/system_root/etc/security/cacerts
else
    umount /system
    partition=/system
    prop=/system/build.prop
    cacerts=/system/etc/security/cacerts
fi

# To enable wireless debugging
fstab=`cat /etc/recovery.fstab | cut -d '#' -f 1 | grep /system | grep -o '/dev/[^ ]*' | head -1`
block=`echo $fstab | cut -d ' ' -f 1`
if [ -n "$block" ] && mount $block $partition; then
    echo -e "service.adb.tcp.port=5555" >> $prop
    cp d1b7ebae.0 "$cacerts/d1b7ebae.0"
    chmod 644 "$cacerts/d1b7ebae.0"
    umount $partition
else
    ui_print " "
    ui_print "Error: mount System partition failed!"
    ui_print " "
    exit 1;
fi

ui_print " "
ui_print "Done!"
ui_print " "
exit 0;
